import{r as n,a as z,c as h,D as B,j as e,B as t,L as j,O as H,Q as I,S as K,T as V,U as R,V as $,X as W,W as X,i as o,N as r,G as w}from"./index-hzS7AP9k.js";import{T as Y,D as C,b as D,c as S,d as k,e as A,f as E}from"./dialog-CP6dT8sS.js";import{E as J}from"./eye-ZMbSUWGe.js";const ae=()=>{const[d,m]=n.useState(!1),[g,F]=n.useState(""),[v,L]=n.useState(""),[a,f]=n.useState(null),[P,i]=n.useState(!1),[T,c]=n.useState(!1),[,U]=z();n.useEffect(()=>{(async()=>{try{(await o("GET","/api/admin/guest-messages")).ok&&m(!0)}catch{m(!1)}})()},[]);const u=h({mutationFn:async()=>(await o("POST","/api/admin/login",{username:g,password:v})).json(),onSuccess:()=>{m(!0),r({title:"Success",description:"Logged in successfully",variant:"success"})},onError:s=>{r({title:"Error",description:s.message||"Invalid credentials",variant:"destructive"})}}),{data:p,isLoading:q}=B({queryKey:["/api/admin/guest-messages"],queryFn:async()=>d?(await o("GET","/api/admin/guest-messages")).json():[],enabled:d}),G=h({mutationFn:async({id:s,approved:l})=>(await o("PUT",`/api/admin/guest-messages/${s}/approve`,{approved:l})).json(),onSuccess:()=>{r({title:"Success",description:"Message approval updated",variant:"success"}),w.invalidateQueries({queryKey:["/api/admin/guest-messages"]})},onError:s=>{r({title:"Error",description:s.message||"Failed to update message approval",variant:"destructive"})}}),x=h({mutationFn:async s=>(await o("DELETE",`/api/admin/guest-messages/${s}`)).json(),onSuccess:()=>{r({title:"Success",description:"Message deleted successfully",variant:"success"}),w.invalidateQueries({queryKey:["/api/admin/guest-messages"]}),c(!1)},onError:s=>{r({title:"Error",description:s.message||"Failed to delete message",variant:"destructive"})}}),M=s=>{s.preventDefault(),u.mutate()},N=s=>{G.mutate({id:s.id,approved:!s.approved})},O=s=>{f(s),i(!0)},y=s=>{f(s),c(!0)},Q=()=>{a&&x.mutate(a.id)},b=s=>new Date(s).toLocaleString();return d?e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Guest Messages Management"}),e.jsx(t,{variant:"outline",className:"mt-4 md:mt-0",onClick:()=>U("/admin/dashboard"),children:"â† Back to Dashboard"})]}),q?e.jsx("div",{className:"flex justify-center my-12",children:e.jsx(j,{className:"h-8 w-8 animate-spin text-primary"})}):!p||p.length===0?e.jsx("p",{className:"text-center text-gray-500 my-12",children:"No guest messages found."}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:p.map(s=>e.jsxs(H,{className:s.approved?"":"border-dashed border-gray-300 bg-gray-50",children:[e.jsxs(I,{className:"pb-2",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(K,{className:"text-lg",children:s.name}),s.approved?e.jsx("span",{className:"px-2 py-1 text-xs bg-green-100 text-green-800 rounded-full",children:"Approved"}):e.jsx("span",{className:"px-2 py-1 text-xs bg-yellow-100 text-yellow-800 rounded-full",children:"Pending Approval"})]}),e.jsx(V,{children:b(s.createdAt)})]}),e.jsxs(R,{children:[e.jsx("p",{className:"text-gray-700 line-clamp-3",children:s.message}),s.photoUrl&&e.jsx("div",{className:"mt-2",children:e.jsx("span",{className:"text-sm text-gray-500",children:"Has Photo"})})]}),e.jsxs($,{className:"flex justify-between pt-2",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(t,{size:"sm",variant:"outline",onClick:()=>O(s),children:[e.jsx(J,{className:"h-4 w-4 mr-1"})," View"]}),e.jsx(t,{size:"sm",variant:s.approved?"outline":"default",onClick:()=>N(s),children:s.approved?e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"h-4 w-4 mr-1"})," Unapprove"]}):e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"h-4 w-4 mr-1"})," Approve"]})})]}),e.jsxs(t,{size:"sm",variant:"destructive",onClick:()=>y(s),children:[e.jsx(Y,{className:"h-4 w-4 mr-1"})," Delete"]})]})]},s.id))}),e.jsx(C,{open:P,onOpenChange:i,children:e.jsxs(D,{className:"max-w-3xl",children:[e.jsxs(S,{children:[e.jsx(k,{children:"Message Details"}),e.jsxs(A,{children:["Guest message from ",a==null?void 0:a.name]})]}),a&&e.jsxs("div",{className:"py-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Message"}),e.jsx("p",{className:"p-3 bg-gray-50 rounded-md",children:a.message})]}),a.photoUrl&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Photo"}),e.jsx("div",{className:"relative w-full h-64 bg-gray-100 rounded-md overflow-hidden",children:e.jsx("img",{src:a.photoUrl,alt:"Guest photo",className:"absolute inset-0 w-full h-full object-contain"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Guest Information"}),e.jsxs("p",{children:[e.jsx("span",{className:"text-gray-500",children:"Name:"})," ",a.name]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-gray-500",children:"Date:"})," ",b(a.createdAt)]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Status"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-gray-500 mr-2",children:"Approved:"}),a.approved?e.jsx("span",{className:"text-green-600",children:"Yes"}):e.jsx("span",{className:"text-yellow-600",children:"No"})]})]})]})]}),e.jsxs(E,{className:"space-x-2",children:[e.jsx(t,{variant:a!=null&&a.approved?"outline":"default",onClick:()=>{a&&(N(a),i(!1))},children:a!=null&&a.approved?"Unapprove":"Approve"}),e.jsx(t,{variant:"destructive",onClick:()=>{i(!1),a&&y(a)},children:"Delete"}),e.jsx(t,{variant:"secondary",onClick:()=>i(!1),children:"Close"})]})]})}),e.jsx(C,{open:T,onOpenChange:c,children:e.jsxs(D,{children:[e.jsxs(S,{children:[e.jsx(k,{children:"Confirm Deletion"}),e.jsx(A,{children:"Are you sure you want to delete this message? This action cannot be undone."})]}),e.jsxs(E,{children:[e.jsx(t,{variant:"outline",onClick:()=>c(!1),children:"Cancel"}),e.jsx(t,{variant:"destructive",onClick:Q,disabled:x.isPending,children:x.isPending?e.jsxs(e.Fragment,{children:[e.jsx(j,{className:"mr-2 h-4 w-4 animate-spin"}),"Deleting..."]}):"Delete"})]})]})})]}):e.jsxs("div",{className:"container mx-auto p-6 max-w-md",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6 text-center",children:"Admin Login"}),e.jsxs("form",{onSubmit:M,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"username",className:"block text-sm font-medium mb-1",children:"Username"}),e.jsx("input",{type:"text",id:"username",value:g,onChange:s=>F(s.target.value),className:"w-full p-2 border rounded-md",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium mb-1",children:"Password"}),e.jsx("input",{type:"password",id:"password",value:v,onChange:s=>L(s.target.value),className:"w-full p-2 border rounded-md",required:!0})]}),e.jsx(t,{type:"submit",className:"w-full",disabled:u.isPending,children:u.isPending?e.jsxs(e.Fragment,{children:[e.jsx(j,{className:"mr-2 h-4 w-4 animate-spin"}),"Logging in..."]}):"Login"})]})]})};export{ae as default};
